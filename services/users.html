<html>
    <head>
        <title>
            Users Page
        </title>
        <script type="text/javascript">
        let string;
        const getUsers = ()=>{
            const _url = 'http://localhost:1269/users/';
            fetch(_url,{
                headers:{
                    'username' : 'tech',
                    'password' : 'tech'
                }
            })
            .then(res=>res.json())
            .then(users=>{
                createTable(users);
            })
            
        }
        const updateuser = (string,string1,string2,string3
        ,string4,string5,string6,string7)=>{
            const baseUrl = 'http://localhost:1269/users';
            let value=parseInt(document.getElementById(`textfield${string}`).value);
            num=value;
            if(num % 2==1){
                fetch(baseUrl+'/update',{
                    method : 'POST',
                    headers:{
                        'username' : 'tech',
                        'password' : 'tech',
                        'content-type': 'application/json'
                    },
                    body:JSON.stringify({
                        ITEMNAME: string2,
     SUBITEM: {
         SUBITME1:{
             id: string,
             SUBITEMNAME: string1,
             QUANTITY : value,
             PRICE: string3
         },
         SUBITME2:{
             id: string4,
            SUBITEMNAME: string5,
            QUANTITY : string7,
            PRICE : string6
        }
     }
                        })
                })
                .then(response=>response.json())
            console.log(string,string1,string2,string3,string4,string5,string6,string7);}
                if(num % 2==0){
                    fetch(baseUrl+'/update',{
                    method : 'POST',
                    headers:{
                        'username' : 'tech',
                        'password' : 'tech',
                        'content-type': 'application/json'
                    },
                    body:JSON.stringify({
                        ITEMNAME: string2,
     SUBITEM: {
         SUBITME1:{
             id: string4,
             SUBITEMNAME: string5,
             QUANTITY : string7,
             PRICE: string6
         },
         SUBITME2:{
             id: string,
            SUBITEMNAME: string1,
            QUANTITY : value,
            PRICE : string3
        }
     }
                        })
                })
                .then(response=>response.json())
                console.log(string,string1,string2,string3,string4,string5,string6,string7);
                }
                const _urlpro = 'http://localhost:1269/projects';
                let price=parseInt(value)*parseInt(string3);
                fetch(_urlpro+'/add',{
                    method : 'POST',
                    headers:{
                        'username' : 'tech',
                        'password' : 'tech',
                        'content-type': 'application/json'
                    },
                    body:JSON.stringify({
                        ITEMNAME:string2,
     SUBITEM: {
         SUBITME:{
             SUBITEMNAME: string1,
             QUANTITY : value,
             PRICE : price
         }
     }
                        })
                })
            .then(res=>res.json())
            .then(projects=>{
                console.log(projects)
                createTableprojects(projects);
            })
            
        }
        const createTable = (data)=>{
            let rows = '';
            data.users.forEach(u => {
                rows += `<tr>
                            <td>${u.ITEMNAME}-</td>
                            <tr><td>${u.SUBITEM.SUBITME1.SUBITEMNAME}  PRICE-${u.SUBITEM.SUBITME1.PRICE}
                            <input id="edit1" type="button" name="edit" value="+" onclick="myplusfunction('${u.SUBITEM.SUBITME1.id}')">
                            <input id="edit1" type="button" name="edit" value="-" onclick="myminusfunction('${u.SUBITEM.SUBITME1.id}')">
                            <input id='textfield${u.SUBITEM.SUBITME1.id}' type="number" name="textfield" width="1" value="0" min="0">VALUE</input>
                            <input id="addtocart" type="button" name="addtocart" value="ADD TO CART" onclick="updateuser
                            ('${u.SUBITEM.SUBITME1.id}','${u.SUBITEM.SUBITME1.SUBITEMNAME}','${u.ITEMNAME}','${u.SUBITEM.SUBITME1.PRICE}'
                            ,'${u.SUBITEM.SUBITME2.id}','${u.SUBITEM.SUBITME2.SUBITEMNAME}','${u.SUBITEM.SUBITME2.PRICE}','${u.SUBITEM.SUBITME2.QUANTITY}')"></td></tr>
                            <tr><td>${u.SUBITEM.SUBITME2.SUBITEMNAME}  PRICE-${u.SUBITEM.SUBITME2.PRICE}
                                <input id="edit1" type="button" name="edit" value="+" onclick="myplusfunction('${u.SUBITEM.SUBITME2.id}')">
                            <input id="edit1" type="button" name="edit" value="-" onclick="myminusfunction('${u.SUBITEM.SUBITME2.id}')">
                            <input id='textfield${u.SUBITEM.SUBITME2.id}' type="number" name="textfield" value="0" size="1" min="0">VALUE</input>
                            <input id="addtocart" type="button" name="addtocart" value="ADD TO CART" onclick="updateuser
                            ('${u.SUBITEM.SUBITME2.id}','${u.SUBITEM.SUBITME2.SUBITEMNAME}','${u.ITEMNAME}','${u.SUBITEM.SUBITME2.PRICE}'
                            ,'${u.SUBITEM.SUBITME1.id}','${u.SUBITEM.SUBITME1.SUBITEMNAME}','${u.SUBITEM.SUBITME1.PRICE}','${u.SUBITEM.SUBITME1.QUANTITY}')"><hr></td></tr>   
                        </tr>`
            });
            const _table = `<table>
                                ${rows}
                            </table>`
            document.getElementById('userss').innerHTML = _table;
        }
        
       function myplusfunction(string){
           let num=parseInt(document.getElementById(`textfield${string}`).value);
            num=num+1;
            document.getElementById(`textfield${string}`).value=num;         
        }
        function myminusfunction(string){
            let num=parseInt(document.getElementById(`textfield${string}`).value);
            num=num-1;
            document.getElementById(`textfield${string}`).value=num;         
        }
        const createTableprojects = (data)=>{
            console.log(data);
            let rows = '';
            data.projects.forEach(u => {
                rows += `<tr>
                            <td>${u.ITEMNAME}</td>
                            <td>${u.SUBITEM.SUBITME.SUBITEMNAME}</td>
                            <td>${u.SUBITEM.SUBITME.QUANTITY}</td>
                            <td>${u.SUBITEM.SUBITME.PRICE}</td>
                        </tr>`
            });
            const _projecttable = `<table border="1">
                               
                                ${rows}
                            </table>`
            document.getElementById('projectslist').innerHTML = _projecttable;
        }
         
        </script>
    </head>
    <body onload="getUsers()">
        <fieldset>
            <legend>HOME PAGE</legend>
            <div id="userss"></div>
        </fieldset>
        <fieldset><legend>
            CART
        </legend>
        <div id="projectslist"></div>
    </fieldset>
    <fieldset>
        <legend>PROCEED</legend>
        TOTAL-<div id="buy"></div>
    </fieldset>

    </div>
    </body>
</html>