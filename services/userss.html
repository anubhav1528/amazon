<html>
    <head>
        <title>
            Users Page
        </title>
        <script type="text/javascript">
        let string;
        const getUsers = ()=>{
            const _url = 'http://localhost:1269/users/';
            fetch(_url,{
                headers:{
                    'username' : 'tech',
                    'password' : 'tech'
                }
            })
            .then(res=>res.json())
            .then(users=>{
                createTable(users);
            })
            
        }
        const updateuser = ()=>{
            const baseUrl = 'http://localhost:1269/users';
            let value=parseInt(document.getElementById('textfield').value)
            
                fetch(baseUrl+'/update',{
                    method : 'POST',
                    headers:{
                        'username' : 'tech',
                        'password' : 'tech',
                        'content-type': 'application/json'
                    },
                    body:JSON.stringify({
                        ITEMNAME:'TRIMMER',
     SUBITEM: {
         SUBITME1:{
             SUBITEMNAME: 'PHILLIPS TRIMMER',
             QUANTITY : value,
             PRICE: 1000
         },
         SUBITME2:{
            SUBITEMNAME: 'LG TRIMMER',
            QUANTITY : 10,
            PRICE : 1800
        }
     }
                        })
                })
                .then(response=>response.json())
                const _urlpro = 'http://localhost:1269/projects';
                fetch(_urlpro+'/add',{
                    method : 'POST',
                    headers:{
                        'username' : 'tech',
                        'password' : 'tech',
                        'content-type': 'application/json'
                    },
                    body:JSON.stringify({
                        ITEMNAME:'TRIMMER',
     SUBITEM: {
         SUBITME1:{
             SUBITEMNAME: 'PHILLIPS TRIMMER',
             QUANTITY : value,
             PRICE : 1000
         }
     }
                        })
                })
            .then(res=>res.json())
            .then(projects=>{
                console.log(projects)
                createTableprojects(projects);
            })
            
        }
        const createTable = (data)=>{
            let rows = '';
            data.users.forEach(u => {
                rows += `<tr>
                            <td>${u.ITEMNAME}-</td>
                            <tr><td>${u.SUBITEM.SUBITME1.SUBITEMNAME}  PRICE-${u.SUBITEM.SUBITME1.PRICE}
                            <input id="edit1" type="button" name="edit" value="+" onclick="myplusfunction()">
                            <input id="edit1" type="button" name="edit" value="-" onclick="myminusfunction()">
                            <input id="textfield_${u.SUBITEM.SUBITME2.SUBITEMNAME}" type="number" name="textfield" width="1" value="0" min="0">VALUE</input>
                            <input id="addtocart" type="button" name="addtocart" value="ADD TO CART" onclick="updateuser()"></td></tr>
                            <tr><td>${u.SUBITEM.SUBITME2.SUBITEMNAME}  PRICE-${u.SUBITEM.SUBITME2.PRICE}
                                <input id="edit1" type="button" name="edit" value="+" onclick="myplusfunction()">
                            <input id="edit1" type="button" name="edit" value="-" onclick="myminusfunction()">
                            <input id="textfield_${u.SUBITEM.SUBITME2.SUBITEMNAME}" type="number" name="textfield" value="0" size="1" min="0">VALUE</input>
                            <input id="addtocart" type="button" name="addtocart" value="ADD TO CART" onclick="updateuser()"><hr></td></tr>   
                        </tr>`
            });
            const _table = `<table>
                                ${rows}
                            </table>`
            document.getElementById('userss').innerHTML = _table;
        }
        
       function myplusfunction(id){
            console.log(string);
            parseInt(document.getElementById(`textfield_${id}`).value)=parseInt(document.getElementById(`textfield_${id}`).value)+1;
        }
        function myminusfunction(string){
console.log(id);
parseInt(document.getElementById(`textfield_${id}`).value)=parseInt(document.getElementById(`textfield_${id}`).value)-1;
        }
        const createTableprojects = (data)=>{
            console.log(data);
            let rows = '';
            data.projects.forEach(u => {
                rows += `<tr>
                            <td>${u.ITEMNAME}</td>
                            <td>${u.SUBITEM.SUBITME1.SUBITEMNAME}</td>
                            <td>${u.SUBITEM.SUBITME1.QUANTITY}</td>
                            <td>${u.SUBITEM.SUBITME1.PRICE}</td>
                        </tr>`
            });
            const _projecttable = `<table border="1">
                               
                                ${rows}
                            </table>`
            document.getElementById('projectslist').innerHTML = _projecttable;
        }
         
        </script>
    </head>
    <body onload="getUsers()">
        <fieldset>
            <legend>HOME PAGE</legend>
            <div id="userss"></div>
        </fieldset>
        <fieldset><legend>
            CART
        </legend>
        <div id="projectslist"></div>
    </fieldset>
    

    </div>
    </body>
</html>